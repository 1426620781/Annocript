                                        |------------------------------------| 
                                        |    Annocript 0.2  Advanced usage   | 
                                        |------------------------------------| 

If you have already experienced several Annocript successful runs you may want to perform some more specific tasks or just using some sections of it (e.g. create only a database, running only some programs 
or only to obtain results). You can do it buy using the user configuration file in a very simple way. 
Please read the following tutorials to do it! 

---------------------------- 
Build a new Protein database 
---------------------------- 


The first thing that you need for you analysis is to install a proteins database with UNIREF or UNIPROT_KB (knowledge base) 
To build a database open the configuration file in the Annocript folder and set parameters as follows: 

                ---------------- TERMINAL ------------------ 
                francesco@compaq2:~/ann_works$ nano config_user.txt 
                ---------------- TERMINAL ------------------ 

Set the name of your fasta sequences file (or a fake one) and choose to execute only the database creation: 

                ---------------- TERMINAL ------------------ 
                fastaSeqs = sequences.fasta 
                
                doDbCreation = YES 
                doExecutePrograms = NO 
                doBuildOutput = NO 
                extractStatistics = NO 
                ---------------- TERMINAL ------------------ 


Put the file with the fasta sequences in your working folder and set the name of the fasta file with sequences: 
fastaSeqs = yourFastaSequences.fasta 
(Since Annocript has been created to do analysis you must set  the fastaSeqs parameters. If you don't want to set 
because you need only a database, please leave the default name. Annocript is smart: if you don't choose to do analysis, 
it will not bother you saying that you don't have transcripts file.) 


On command line go to your chose folder and run Annocript (the config_user.txt file must stay in your working directory) 

                ---------------- TERMINAL ------------------ 
                francesco@compaq2:~/ann_works$../Annocript/the_annocript.pl config_user.txt 
                
        
                1. New session - 2. Use Previous - 3. Exit 
                Your choose:  1 

                Choose a name for your session: new_database 
                /home/francesco/ann_works/jobs/new_database created! 

                Copying the given config file in /home/francesco/ann_works/jobs/new_database 
                ##################################################### 
                # CHECKING THE INTEGRITY OF THE CONFIGURATION FILES # 
                ##################################################### 
                They are good. Annocript can proceed! 
                ################################### 
                # RUNNING ANNOCRIPT CONFIGURATION # 
                ################################### 
                DB file will be downloaded from UNIPROT website and DB built. 
                The final table will be built 
                A web page and file with statistics will be created 
                Do you agree with it?(y or n) y 
                Ok!.. let's go! 
                ---------------- TERMINAL ------------------ 

Annocript will be busy checking the configuration file searching for errors and checking for correct paths and URLs. 
If all is good you will be asked something depending on what you chose in the config file and if the configuration is 
correct. 

                ---------------- TERMINAL ------------------ 
                >>> Database settings: 
                ...DONE! 
                ---------------- TERMINAL ------------------ 

Both the UNIREF and the UNIPROT knowledge base databases can be chosen to be downloaded. You could also install 
both (one per time) and decide later what to use during the execution. 

                ---------------- TERMINAL ------------------ 
                You chose to create the database. Do you want to create with UNIREF (r) or UNIPROT (p)? (r or p) r 
                kbVersion: 2014_01 
                Folder for DB will be: /home/francesco/ann_works/data/2014_01 and database name: uniref_2014_01 
                
                The Conserved Domains database: Cdd 
                During this process Annocript will download a set of files with big dimension. These data will be used 
                to create a large  database with all the data. Do you want that Annocript erase them? (y or n). 
                Press x to exit Annocript. 
                 n 
                
                >>> Programs settings: 
                Sequences found in your session folder... 
                Annocript detected that your sequences are dna 
                >>> Setting final statistics and outputs 
                ..OK! WELL DONE! 
                Your configuration has been saved! A log file will be created in 
                /home/francesco/ann_works/jobs/new_database/log/annocript_exec_Mon_Sep_16_09:46:47_2013.log. 
                The overall computation usually depends from the number of sequences and the speed of the machine 
                you are using. 
                You will find all the results in the folder you chose here. 
                
                Please let us know if some problem occurs during the computation or you don't  retrieve what you are 
                expecting from Annocript. 
                
                ######################################### 
                # ANNOCRIPT STARTED IN BACKGROUND! BYE! # 
                ######################################### 
                ---------------- TERMINAL ------------------ 

If something goes wrong Annocript alerts you in the terminal output and in log file. 
Your DB will be created in few hours depending from the speed of connection and from you configuration. 
You can have a look at the log file in the log folder. 

NOTE: We chose to call the database referring to the version of the UNIPROT database. 
Actually it is out the version of january 2014. We called this database uniref_2014_01. 
The date is taken automatically from a corresponding release_note file. 



---------------------------- 
Starting Programs execution 
---------------------------- 

If you created the proteins database already and/or you want to run only analysis on your sequences then open the 
configuration file (config_user.txt) in the Annocript folder and set parameters as follows: 

                ---------------- TERMINAL ------------------ 
                francesco@Z800:~/Annocript$ nano config_user.txt 
                ---------------- TERMINAL ------------------ 

Set the name of your fasta sequences file and choose to execute only programs: 

                ---------------- TERMINAL ------------------ 
                fastaSeqs = sequences.fasta 
                
                doDbCreation = NO 
                doExecutePrograms = YES 
                doBuildOutput = NO 
                extractStatistics = NO 
                ---------------- TERMINAL ------------------ 

Choose the programs you want to execute (here we chose all): 

                ---------------- TERMINAL ------------------ 
                #What programs to execute 
                doBlastx = YES 
                doRpstblastn = YES 
                doBlastn = YES 
                doPortrait = YES 
                doDna2Pep = YES 
                ---------------- TERMINAL ------------------ 

In the configuration file for user you can set the parameters for the programs.

Put the FASTA file in the working directory (e.g. ann_works). (It will be shifted by Annocript in your jobs folder) 
Put the config_user.txt file in your working directory. 

                ---------------- TERMINAL ------------------ 
                francesco@Z800:~/Annocript$ cp config_user.txt ../ann_works/ 
                ---------------- TERMINAL ------------------ 

On command line go to your chose folder and run Annocript 

                ---------------- TERMINAL ------------------ 
                francesco@Z800:~/$ cd ../ann_works/ 
                francesco@Z800:~/ann_works/$ ../Annocript/the_annocript.pl config_user.txt 
                ---------------- TERMINAL ------------------ 

IMPORTANT: if you already ran some program, a second run will destroy the previous results. If some output is already 
          present, Annocript will ask if you are sure to delete. 

Annocript starts asking about the session to use. 

                ---------------- TERMINAL ------------------ 
                1. New session - 2. Use Previous - 3. Exit 
                Your choose:  1 
                Choose a name for your session: pseudonitzschia    
                /home/francesco/myAnnocript/jobs/pseudonitzschia created! 
                Copying the given config file in /home/francesco/test/jobs/pseudonitzschia 
                
                ##################################################### 
                # CHECKING THE INTEGRITY OF THE CONFIGURATION FILES # 
                ##################################################### 
                
                They are good. Annocript can proceed! 
                ################################### 
                # RUNNING ANNOCRIPT CONFIGURATION # 
                ################################### 

                Some programs will be run. In the following are listed 
                The final table will be built 
                A web page and file with statistics will be created 
                A blastx of your sequences will be done. 
                A rpstblastn of your sequences will be done. 
                A blastn of your sequences will be done. 
                Do you agree with it?(y or n) y
                
                Ok!.. let's go! 
                
                Checking : DB_Creation configuration...Checking the links... this can take a while.. please wait..... 
                ..DONE! 
                ---------------- TERMINAL ------------------ 

Since you already created the database, Annocript will ask to you what to use: 

                ---------------- TERMINAL ------------------ 
                DB Creation Not Active: Database will not be downloaded and installed. 
                You chose to use an existent database, are you sure?(y or n) y 
                
                Choose the database version: 
		2013_08  2013_09  2014_01
                ---------------- TERMINAL ------------------ 


Annocript will check if UNIREF or UNIPROT_KB databases are present and ask to you to choose one. If one only is 
present, it will be used automatically. 

                ---------------- TERMINAL ------------------ 
                Uniref database is the only present. Using it... 
                Conserved Domains database: Cdd 
                >>> Programs settings: 
                Sequences found in your session folder... 
                Annocript detected that your sequences are dna 
                >>> Setting final statistics and outputs 
                ..OK! WELL DONE! 
                Your configuration has been saved! A log file will be created in 
                /home/francesco/ann_works/jobs/pseudonitzschia/log/annocript_exec_Mon_Sep_16_09:46:47_2013.log. 
                The overall computation usually depends from the number of sequences and the speed of the machine 
                you are using. 
                You will find all the results in the folder you chose here. 
                Please let us know if some problem occurs during the computation or you don't  retrieve what you are 
                expecting from Annocript. 
                
                ######################################### 
                #STARTING ANNOCRIPT IN BACKGROUND! BYE! # 
                ######################################### 
                ---------------- TERMINAL ------------------ 


Once you did it, Annocript will start with the execution of programs that you chose in the config_user.txt file. 
If something goes wrong, Annocript will alert you in the log file. 


*Check of the results 

All BLAST output will be stored in the folder OUTPUT of your session folder. They will be checked by Annocript in this way: if the number of output sequences is different 
from the total number of sequences in your query file, than there's a problem and you will be informed. 


TO REMEMBER: You can run the programs provided by Annocript (BLAST, PORTRAIT and DNA2PEP ) also in a unique way. 
You can think to run only BLASTX and no other stuff simply because you need the output of the BLASTX. Or you can 
have the output of BLASTX for your sequences and you want only to run the other programs. 


------------------ 
Print informations 
------------------ 

If you already get the results of the programs you can start the module to get only the statistics. 
To do this you have to inform Annocript that you want to run the modules for print out only. 
Open the configuration file in the Annocript folder and set parameters as follows: 

                ---------------- TERMINAL ------------------ 
                doDbCreation = NO 
                doExecutePrograms = NO 
                doBuildOutput = YES 
                extractStatistics = YES 
                ---------------- TERMINAL ------------------ 

(Here we do not specify to write the FASTA file name because we are considering that you already ran the 
ExecutePrograms and DBCreation modules and you are simply using the same configuration file.) 

Then run Annocript! 
                
                ---------------- TERMINAL ------------------ 
                francesco@Z800:~/ann_works ../Annocript/the_annocript_prova.pl config_user.txt 
                
                1. New session - 2. Use Previous - 3. Exit 
                Your choose:  2 
                eraseme  parenysensis 
                
                Choose your folder: eraseme 
                Copying the given config file in /home/francesco/test/jobs/eraseme 
                ##################################################### 
                # CHECKING THE INTEGRITY OF THE CONFIGURATION FILES # 
                ##################################################### 
                
                They are good. Annocript can proceed! 
                ################################### 
                # RUNNING ANNOCRIPT CONFIGURATION # 
                ################################### 

                The final table will be built 
                A web page and file with statistics will be created 
                Do you agree with the following configuration?(y or n) y 
                Ok!.. let's go! 

                >>> Database settings (if you chose to create the database, it will need a while): 
                DB Creation Not Active: Database will not be downloaded and installed. 
                You chose to use some existent db files, are you sure?(y or n) y 
                2013_07 
                Choose your folder: 2013_07 
                Uniref and Uniprot databases are both there. What do you want to use? UNIREF (r) or UNIPROT (p)? 
                (r or p) r 
                The Conserved Domains database used will be: Cdd 
                
                >>> Programs settings: 
                Path to control for fasta: /home/francesco/test/trial_transcriptome.fasta 
                Sequences found in your session folder... 
                Annocript detected that your sequences are dna 
                
                >>> Setting final statistics and outputs 
                ..OK! WELL DONE! 
                
                Your configuration has been saved! A log file will be created in 
                /home/francesco/ann_works/jobs/eraseme/log/ annocript_exec_Mon_Sep_30_17:38:05_2013.log. 
                The overall computation usually depends from the number of sequences and the speed of the machine 
                you are using. 
                You will find all the results in the folder you chose here. 
                
                Please let us know if some problem occurs during the computation or you don't  retrieve what you are 
                expecting from Annocript. 
                ########################################## 
                # STARTING ANNOCRIPT IN BACKGROUND! BYE! # 
                ########################################## 
                ---------------- TERMINAL ------------------ 


The output and statistics will be all stored inside the 'stats' and 'output' folders. 


------------
HINTS & TIPS
------------

Here you'll find some tricks to obtain that Annocript does something that you want but actually its normal functioning 
does not permits it.


*How to run Annocript with already downloaded db files

Since Annocript is downloading from external sources the database files you could experience some problems that are
independent from Annocript code. Sometimes a good connection is not available and permission on Uniprot servers can change
making Annocript blocking on downloads or uncompressions. 
For this reason we add simple istructions here on how to run Annocript with already downloaded db files. 
To perform this task you should simply:
	- access the file config_annocript.txt
	- download all the files that are given as links to external source (using Linux wget or other ways)
	- uncompress the files
While you are downloading the overall db, you will see the release date file. This file (different for Uniref and 
Uniprot_kb) is needed by Annocript to create a folder to use for all the data (usually YEAR_MONTH. For example 2014_02).
This folder is created by Annocript in the ann_works/data folder. If it has not been created yet by Annocript, you must
create it by reading the release date in uniref90.release_note (for Uniref90 db) or reldate.txt (for Uniprot_kb db).
Then the release date file should be inserted in the parent data folder.
The final situation should be that you have:
ann_works/data/reldate.txt present
and
ann_works/data/2014_02 containing all the uncompressed files.

Then you can start Annocript's DB_CREATION and ignore all the warnings you will receive.



*Running your own multiple output files

Sometimes is preferable to run different time BLAST programs to have better performance in terms of time and resources 
managament. Then you can have different output file for the same input transcript. You can put all the files together 
in the apposite folder of the program by using the same name you chose in the configuration file of Annocript adding 
numbers (default is for example blastTROut for the result of TREMBL).

Actually this can be done only for the BLAST programs.
Follow these steps:
1. Create your output files by using BLAST programs without Annocript.
2. Change their names according to the variable blastxSPOut, blastnOut, rpstblastnOut in the annocript_configuration.txt 
file. And for each file please put a number that indicate the successive outputs (i.e. BlastxSPOut1, blastxSPOut2,
blastxSPOut3). Annocript is prepared to read them whatever is the number.
3. Put the files just modified in the corresponding output folder of the BLAST program. At its first starting Annocript
creates for you the folders output and there the corresponding folder for the specific BLAST program (BLASTX, RPSTBLASTN, 
BLASTN).
4. Open the config_user.txt files and modify the execution as you learned here. The important thing is that the 
programs that you don't want to execute because you already have to output, must have the â€œNOâ€ value. For example, 
if you have output for all the BLASTX you must have doBlastx=NO.
5. Start Annocript!



*Using different Conserved Domains Databases

If you want to use another database different from the Cdd one, you can choose one at 
(ftp://ftp.ncbi.nih.gov/pub/mmdb/cdd/little_endian/). To use it you have to:
change the link cdDBLink  in the Annocript configuration file to use one of the databases present 
(Pfam, Cog, Kog, Cdd, Smart, Prk, Tigr). (The extension .rps is of the file that Annocript will search to check if the 
indexed database already exists).
Run the DB creation of Annocript.

Suppose now that you already installed DB with Annocript with Smart CD db and you want to use also Pfam. What can 
you do?

You can do it but the solution is little manual. 
You should download the DB manually with wget or some other FTP program
decompress it and put all the files inside the DATA folder where you are interested it is;
Then you can normally start Annocript: it will ask to you what cd database to use.



*Using different UNIPROT databases with the same installation

When you run Annocript for the creation of database, the last version of UNIPROT_KB or UNIREF will be downloaded. 
A new folder with the month and day of the version will be created.  Suppose it's october 2013, it will be 2013_10.
When Annocript creates the database it downloads some compressed files related to the proteins, domains, the ribosomial 
sequences. While the proteins database changes more frequently the other two can remain a lot of time with always the 
same version. 
If you are working on october, maybe on december proteins database will change and Annocript could create a new folder 
with a new protein database and the same domains and ribosomial sequences. This will occupy a lot of space on your 
system.
One simple thing that you can do is to not erase the zip files from the data folder (Annocript will ask it during the 
configuration) and move them to the next folder. This requires a bit of experience manipulating file and folders.
Annocript will create the database folder just during the configuration. Thus you should stop Annocript after it 
alerted you of this and fill the folder with the archives you already have. At next execution Annocript will find 
and not download.


*Creating again an existing database

If you do not cancelled the compressed or uncompressed files of the database, you can later recreate it if
Annocript has been updated or the system had some problem. Simply you should put the version file in the ann_works/data
folder and run Annocript database creation again. It will find that version and will not create and download existing file.
Instead it will create everything again asking you to be sure to cancel the existing MySQL database.


*Using different Uniref types of databases (100, 90, 50)

If you are deciding to use the Uniref database it will reduce the computational time for both the construction of the database and running of blastx. Results are similar to those with uniprot_kb with only a little loose in specificity. 
The default type in Annocript is the Uniref90 but you may want to use another among 100 or 50. To use those you have simply to specify the different database links inside the annocript_config.txt file.
Variables to change are: unirefDBLink and unirefVerLink

Actually (may 2014) these links for 50 and 100 are working:
50's:
unirefDBLink = ftp://ftp.uniprot.org/pub/databases/uniprot/current_release/uniref/uniref50/uniref50.fasta.gz
unirefVerLink = ftp://ftp.uniprot.org/pub/databases/uniprot/current_release/uniref/uniref50/uniref50.release_note
100's:
unirefDBLink = ftp://ftp.uniprot.org/pub/databases/uniprot/current_release/uniref/uniref100/uniref90.fasta.gz
unirefVerLink = ftp://ftp.uniprot.org/pub/databases/uniprot/current_release/uniref/uniref100/uniref100.release_note

All the results will be given respect to the database chose.